<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Game Time Availability</title>
<style>
  body {
    font-family: Arial, sans-serif;
    padding: 20px;
    max-width: 600px;
    margin: auto;
    background: #f7f7f7;
  }
  h1 {
    text-align: center;
  }
  label {
    display: inline-block;
    margin-right: 10px;
  }
  .user-select {
    margin-bottom: 20px;
    font-weight: bold;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 20px;
  }
  th, td {
    border: 1px solid #ccc;
    padding: 8px;
    text-align: center;
  }
  th {
    background: #eee;
  }
  button {
    padding: 10px;
    font-size: 1rem;
    background: #4CAF50;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
  }
  #status {
    text-align: center;
    margin-top: 10px;
    font-weight: bold;
  }
</style>
</head>
<body>

<h1>Game Time Weekly Availability</h1>

<div class="user-select">
  Select your name:
  <select id="userSelect">
    <option value="Rhys">Rhys</option>
    <option value="Kris">Kris</option>
    <option value="Matty">Matty</option>
    <option value="Granty">Granty</option>
  </select>
</div>

<form id="availabilityForm">

  <table>
    <thead>
      <tr>
        <th>Day</th>
        <th>Afternoon</th>
        <th>Evening</th>
      </tr>
    </thead>
    <tbody id="formBody">
      <!-- Rows inserted by JS -->
    </tbody>
  </table>

  <button type="submit">Save Availability</button>
</form>

<div id="status"></div>

<h2>Combined Availability</h2>
<div id="combinedResults">
  <!-- Live combined data will show here -->
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
  // TODO: Replace with your Firebase config from step 1B
const firebaseConfig = {
  apiKey: "AIzaSyD8Za1qEgeVqQY-ZPoAVxbQxNk2gIX_2ic",
  authDomain: "game-time-for-grown-ups.firebaseapp.com",
  databaseURL: "databaseURL: "https://game-time-for-grown-ups-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "game-time-for-grown-ups",
  storageBucket: "game-time-for-grown-ups.firebasestorage.app",
  messagingSenderId: "240776591169",
  appId: "1:240776591169:web:ecd7125da1acf789ed93c0",
  measurementId: "G-XFKFZT1FMG"
};

  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  const users = ["Rhys", "Kris", "Matty", "Granty"];
  const days = ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"];
  const slots = ["Afternoon", "Evening"];

  const formBody = document.getElementById("formBody");
  const userSelect = document.getElementById("userSelect");
  const availabilityForm = document.getElementById("availabilityForm");
  const statusDiv = document.getElementById("status");
  const combinedResults = document.getElementById("combinedResults");

  // Build the form table rows
  function buildForm() {
    formBody.innerHTML = "";
    for (const day of days) {
      const tr = document.createElement("tr");
      const dayTd = document.createElement("td");
      dayTd.textContent = day;
      tr.appendChild(dayTd);

      for (const slot of slots) {
        const td = document.createElement("td");
        const checkbox = document.createElement("input");
        checkbox.type = "checkbox";
        checkbox.name = `${day}_${slot}`;
        td.appendChild(checkbox);
        tr.appendChild(td);
      }

      formBody.appendChild(tr);
    }
  }

  // Load user data from Firebase and update form
  function loadUserData(user) {
    db.ref(`availability/${user}`).once("value").then(snapshot => {
      const data = snapshot.val() || {};
      // Clear all checkboxes first
      for (const day of days) {
        for (const slot of slots) {
          const checkbox = availabilityForm.elements[`${day}_${slot}`];
          checkbox.checked = !!data[`${day}_${slot}`];
        }
      }
    });
  }

  // Save user data to Firebase
  availabilityForm.addEventListener("submit", e => {
    e.preventDefault();
    const user = userSelect.value;
    const userData = {};
    for (const day of days) {
      for (const slot of slots) {
        const checkbox = availabilityForm.elements[`${day}_${slot}`];
        userData[`${day}_${slot}`] = checkbox.checked;
      }
    }
    db.ref(`availability/${user}`).set(userData)
      .then(() => {
        statusDiv.textContent = "Availability saved!";
      })
      .catch(err => {
        statusDiv.textContent = "Error saving data: " + err;
      });
  });

  // Show combined availability for all users
  function showCombinedData(allData) {
    if (!allData) {
      combinedResults.textContent = "No availability data yet.";
      return;
    }

    // Build a table with days, slots, and users who are available
    const table = document.createElement("table");
    table.style.borderCollapse = "collapse";
    table.style.width = "100%";

    const thead = document.createElement("thead");
    const headerRow = document.createElement("tr");
    headerRow.appendChild(document.createElement("th")); // empty corner cell

    for (const user of users) {
      const th = document.createElement("th");
      th.textContent = user;
      headerRow.appendChild(th);
    }
    thead.appendChild(headerRow);
    table.appendChild(thead);

    const tbody = document.createElement("tbody");

    for (const day of days) {
      for (const slot of slots) {
        const tr = document.createElement("tr");
        const daySlotTd = document.createElement("td");
        daySlotTd.textContent = `${day} ${slot}`;
        tr.appendChild(daySlotTd);

        for (const user of users) {
          const td = document.createElement("td");
          const available = allData[user] && allData[user][`${day}_${slot}`];
          td.textContent = available ? "✔️" : "";
          td.style.textAlign = "center";
          tr.appendChild(td);
        }

        tbody.appendChild(tr);
      }
    }

    table.appendChild(tbody);
    combinedResults.innerHTML = "";
    combinedResults.appendChild(table);
  }

  // Listen for data changes in realtime
  db.ref("availability").on("value", snapshot => {
    showCombinedData(snapshot.val());
  });

  // When user changes selection, load their data
  userSelect.addEventListener("change", () => {
    loadUserData(userSelect.value);
    statusDiv.textContent = "";
  });

  // Init form
  buildForm();
  loadUserData(userSelect.value);

</script>

</body>
</html>
