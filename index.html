<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Game Time for Grown Ups</title>
<style>
  body {
    font-family: Arial, sans-serif;
    padding: 20px;
    max-width: 600px;
    margin: auto;
    background: #003a78; /* Dark blue from image */
    color: white;
  }
  h1 {
    text-align: center;
    font-size: 1.8rem;
    margin-bottom: 0.3em;
  }
  .logo {
    display: block;
    margin: 0 auto 20px auto;
    max-width: 180px;
  }
  label {
    display: inline-block;
    margin-right: 10px;
  }
  .user-select {
    margin-bottom: 20px;
    font-weight: bold;
    background-color: #0b64bf; /* lighter blue from wave */
    padding: 8px 12px;
    border-radius: 6px;
  }
  select {
    background-color: #0b64bf; /* keep same as container for seamless */
    color: white;
    border: none;
    padding: 6px 10px;
    font-weight: bold;
    border-radius: 4px;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 20px;
    background-color: #0b64bf; /* lighter blue from wave */
    border-radius: 6px;
    overflow: hidden;
  }
  th, td {
    border: 1px solid #003a78;
    padding: 8px;
    text-align: center;
  }
  th {
    background: #0f7eea; /* a bit brighter */
  }
  button {
    width: 100%;
    padding: 12px;
    font-size: 1rem;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    margin-bottom: 15px;
  }
  #saveBtn {
    background-color: #4CAF50; /* green */
  }
  #resetBtn {
    background-color: #d9534f; /* bootstrap red */
  }
  #status {
    text-align: center;
    margin-top: 10px;
    font-weight: bold;
  }
  #combinedResults table {
    background-color: #0b64bf;
    color: white;
  }
</style>
</head>
<body>

<h1>Game Time for Grown Ups</h1>

<img src="https://www.pinpng.com/pngs/m/152-1527351_02-oct-2014-playstation-logo-white-hd-png.png" alt="PS5 Logo" class="logo" />

<div class="user-select" aria-label="Select your name">
  Select your name:
  <select id="userSelect" aria-label="User name select">
    <option value="Rhys">Rhys</option>
    <option value="Kris">Kris</option>
    <option value="Matty">Matty</option>
    <option value="Granty">Granty</option>
  </select>
</div>

<form id="availabilityForm">

  <table>
    <thead>
      <tr>
        <th>Day</th>
        <th>Afternoon</th>
        <th>Evening</th>
      </tr>
    </thead>
    <tbody id="formBody">
      <!-- Rows inserted by JS -->
    </tbody>
  </table>

  <button id="saveBtn" type="submit">Save Availability</button>
</form>

<div id="status"></div>

<h2>Combined Availability</h2>
<div id="combinedResults">
  <!-- Live combined data will show here -->
</div>

<button id="resetBtn" type="button">Reset Week</button>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyD8Za1qEgeVqQY-ZPoAVxbQxNk2gIX_2ic",
    authDomain: "game-time-for-grown-ups.firebaseapp.com",
    databaseURL: "https://game-time-for-grown-ups-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "game-time-for-grown-ups",
    storageBucket: "game-time-for-grown-ups.firebasestorage.app",
    messagingSenderId: "240776591169",
    appId: "1:240776591169:web:ecd7125da1acf789ed93c0",
    measurementId: "G-XFKFZT1FMG"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  const users = ["Rhys", "Kris", "Matty", "Granty"];
  const days = ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"];
  const slots = ["Afternoon", "Evening"];

  const formBody = document.getElementById("formBody");
  const userSelect = document.getElementById("userSelect");
  const availabilityForm = document.getElementById("availabilityForm");
  const statusDiv = document.getElementById("status");
  const combinedResults = document.getElementById("combinedResults");
  const resetBtn = document.getElementById("resetBtn");

  function buildForm() {
    formBody.innerHTML = "";
    for (const day of days) {
      const tr = document.createElement("tr");
      const dayTd = document.createElement("td");
      dayTd.textContent = day;
      tr.appendChild(dayTd);

      for (const slot of slots) {
        const td = document.createElement("td");
        const checkbox = document.createElement("input");
        checkbox.type = "checkbox";
        checkbox.name = `${day}_${slot}`;
        td.appendChild(checkbox);
        tr.appendChild(td);
      }

      formBody.appendChild(tr);
    }
  }

  function loadUserData(user) {
    db.ref(`availability/${user}`).once("value").then(snapshot => {
      const data = snapshot.val() || {};
      for (const day of days) {
        for (const slot of slots) {
          const checkbox = availabilityForm.elements[`${day}_${slot}`];
          checkbox.checked = !!data[`${day}_${slot}`];
        }
      }
    });
  }

  availabilityForm.addEventListener("submit", e => {
    e.preventDefault();
    const user = userSelect.value;
    const userData = {};
    for (const day of days) {
      for (const slot of slots) {
        const checkbox = availabilityForm.elements[`${day}_${slot}`];
        userData[`${day}_${slot}`] = checkbox.checked;
      }
    }
    db.ref(`availability/${user}`).set(userData)
      .then(() => {
        statusDiv.textContent = "Availability saved!";
      })
      .catch(err => {
        statusDiv.textContent = "Error saving data: " + err;
      });
  });

  function showCombinedData(allData) {
    if (!allData) {
      combinedResults.textContent = "No availability data yet.";
      return;
    }

    const table = document.createElement("table");
    table.style.borderCollapse = "collapse";
    table.style.width = "100%";

    const thead = document.createElement("thead");
    const headerRow = document.createElement("tr");
    headerRow.appendChild(document.createElement("th")); // empty corner cell

    for (const user of users) {
      const th = document.createElement("th");
      th.textContent = user;
      headerRow.appendChild(th);
    }
    thead.appendChild(headerRow);
    table.appendChild(thead);

    const tbody = document.createElement("tbody");

    for (const day of days) {
      for (const slot of slots) {
        const tr = document.createElement("tr");
        const daySlotTd = document.createElement("td");
        daySlotTd.textContent = `${day} ${slot}`;
        tr.appendChild(daySlotTd);

        for (const user of users) {
          const td = document.createElement("td");
          const available = allData[user] && allData[user][`${day}_${slot}`];
          td.textContent = available ? "✔️" : "";
          td.style.textAlign = "center";
          tr.appendChild(td);
        }

        tbody.appendChild(tr);
      }
    }

    table.appendChild(tbody);
    combinedResults.innerHTML = "";
    combinedResults.appendChild(table);
  }

  db.ref("availability").on("value", snapshot => {
    showCombinedData(snapshot.val());
  });

  userSelect.addEventListener("change", () => {
    loadUserData(userSelect.value);
    statusDiv.textContent = "";
  });

  resetBtn.addEventListener("click", () => {
    if (confirm("Are you sure you want to reset all availability for the week?")) {
      // Reset all user data
      users.forEach(user => {
        db.ref(`availability/${user}`).remove();
      });
      statusDiv.textContent = "All availability has been reset.";
      // Clear checkboxes for current user as well
      buildForm();
    }
  });

  buildForm();
  loadUserData(userSelect.value);
</script>

</body>
</html>
